name: Testing a Website

on: 
    push:
        branches: ["main"]
    pull_request:
        branches: ["main"]
    workflow_dispatch:

jobs:
    build_website:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - name: Use Node.js
              uses: actions/setup-node@v4
            - name: Build the Website
              run: |
                yarn install
                yarn build
                yarn lint
                ls -l
                echo "Checking inside build folder"
                cd build/
                ls -l
            - uses: actions/upload-artifact@v4
              with:
                name: my-artifact
                path: build/
                
    test_website:
        runs-on: ubuntu-latest
        needs: build_website
        steps:
            - uses: actions/checkout@v4
            - name: Download Artifacts
              uses: actions/download-artifact@v4  
              with: 
                  path: .  
            - name: Run website Test
              run: |
                # ls -l 
                # cd my-artifact
                # ls -l
                if test -f "index.html"; then
                    echo "Test Passed"
                else
                    echo "Test Failed"
                fi
                if test -f "build/index.html"; then
                    echo "Test Passed"
                else
                    echo "Test Failed"
                fi

    # deploy-to-s3:
    #     runs-on: ubuntu-latest
    #     needs: build_website
    #     steps: 
    #       - uses: actions/checkout@v4
    #       - uses: actions/download-artifact@v4
    #       - uses: actions/setup-python@v2
    #         with:
    #             python-version: '3.10'
    #       - name: Install dependencies
    #         run: |
    #           python -m pip install --upgrade pip
    #           pip install awscli
    #       - name: Run AWS CLI Commands
    #         run: |
    #             echo "You're in AWS Cli mode"
    #             aws --version
    #             echo "Hello S3" > test.txt
    #             ls -l
    #             aws s3 sync build/ s3://temp-terraform-s3bucket/web/
    #         env: 
    #            AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
    #            AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
